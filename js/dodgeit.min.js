window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()),Math.randomRange=function(a,b){return Math.random()*(b-a)+a},Math.randomWeighted=function(a){for(var b=a.reduce(function(a,b){return a+b},0),c=Math.randomRange(0,b),d=0,e=0;e<=a.length-1;e++)if(d+=a[e],d>c)return e},$(function(){var a={music:function(){var a=10,b=["music/01_A_Night_Of_Dizzy_Spells.mp3","music/02_Underclocked_(underunderclocked_mix).mp3","music/03_Chibi_Ninja.mp3"],c=-1,d=null,e=function(){c=-1==c?Math.floor(Math.random()*b.length):(c+1)%b.length,d.get(0).pause(),d.empty().append($("<source>").attr("src",b[c]).attr("type","audio/mpeg")),d.get(0).play()};d=$("<audio></audio").bind("ended",function(){e()});var f={};return Object.defineProperty(f,"mute",{get:function(){return d.get(0).muted},set:function(a){d.get(0).muted=a}}),f.mute=!1,Object.defineProperty(f,"volume",{get:function(){return d.get(0).volume*a},set:function(b){b>=0&&a>=b&&(d.get(0).volume=b/a)}}),f.volume=5,e(),{options:f,nexttrack:e}}(),sfx:{options:{mute:!1,volume:5},max:10,init:function(){Object.defineProperty(this,"mute",{get:function(){return this.options.mute},set:function(a){this.options.mute=a}}),this.mute=!1,Object.defineProperty(this,"volume",{get:function(){return this.options.volume},set:function(a){this.options.volume=a}}),this.volume=5},play:function(){}}},b=function(){var b=!1,c=function(){b=!1;var c=localStorage.getItem("options");try{c=JSON.parse(c)}catch(d){return}c&&(c.audio&&(a.music.options.mute=c.audio.music.mute,a.music.options.volume=c.audio.music.volume,a.sfx.options.mute=c.audio.sfx.mute,a.sfx.options.volume=c.audio.sfx.volume),c.options&&(this.options.name=c.options.name?c.options.name:this.options.name,this.options.car=c.options.car?c.options.car:this.options.car,this.options.speed=c.options.speed?c.options.speed:this.options.speed)),b=!0},d=function(){if(b){var c={audio:{music:{mute:a.music.options.mute,volume:a.music.options.volume},sfx:{mute:a.sfx.options.mute,volume:a.sfx.options.volume}},controls:{},options:{name:this.options.name,style:this.options.car,speed:this.options.speed}};localStorage.setItem("options",JSON.stringify(c))}},e={name:"Unknown",style:"car",speed:300},f=$("div#game");return f.children().hide(),c(),{container:f,options:e,load:c,save:d}}(),c={post:function(a,b){var c="https://docs.google.com/forms/d/1O4OfBssi1MZZd1v7gfo_bsyU_r52IVSN8GEYH1I2Luo/formResponse";$.post(c,{"entry.1065023134":a,"entry.1650551768":b})},get:function(a,b,c){var d=this;c.empty().append($("<tr></tr>").addClass("loading").append($("<td></td>").attr("colspan",3).html("Loading...")));var e="1bWUyCx4cLJn6EXe_0Y8NxJ3iJhjqMM5pHfSCEuVD8Ec";$.ajax({url:"https://docs.google.com/spreadsheets/d/"+e+"/gviz/tq?",dataType:"jsonp",type:"GET",cache:!1,data:{tq:"select B, C order by C desc",tqx:"responseHandler:success"},success:function(e){var f=[];$.each(e.table.rows,function(a,b){f.push({name:b.c[0].v,score:b.c[1].v})}),c.empty();for(var g=a;b-1>=g-a;g++)g<=f.length-1?$("<tr></tr>").appendTo(c).append($("<td></td>").html(g+1)).append($("<td></td>").html(f[g].name)).append($("<td></td>").html(f[g].score)):$("<tr></tr>").appendTo(c).append("<td>&nbsp;</td>").append("<td>&nbsp;</td>").append("<td>&nbsp;</td>");var h=$("<tr></tr>").appendTo(c).addClass("buttons"),i=$("<td></td>").attr("colspan",2).appendTo(h),j=$("<td></td>").appendTo(h);0!=a&&i.append($("<button></button>").html("previous "+b).click(function(){d.get(a-b,b,c)})),f.length>=a+b&&j.append($("<button></button>").html("next "+b).click(function(){d.get(a+b,b,c)}))},jsonpCallback:"success"})}},d=function(){var a={command:{},gamepad:{buttons:[],axes:[],axes_selected:0,timestamp:0,available:!1},orientation:{beta:null,gamma:null,available:!1},set:{active:!1,key:"",abort:{device:"keyboard",type:null,code:27},callback:null}},b=function(b){b=a.command[b];var c=function(){b.fn()},d=function(a){b.fn=a};return{call:c,set:d,pressed:b.pressed}},c=function(b){var c=!0;return a.set.active?(a.set.abort.device!=b.device||a.set.abort.type!=b.type||a.set.abort.code!=b.code?(a.command[a.set.key].device=b.device,a.command[a.set.key].type=b.type,a.command[a.set.key].code=b.code,a.set.callback(b)):a.set.callback(null),a.set.active=!1,c=!1):$.each(a.command,function(a,d){return d.device==b.device&&d.type==b.type&&d.code==b.code?(d.pressed=!0,d.fn(),c=!1,!1):void 0}),c},d=function(b){var c=!0;return $.each(a.command,function(a,d){return d.device==b.device&&d.type==b.type&&d.code==b.code?(d.pressed=!1,c=!1,!1):void 0}),c},e=function(a){if("keyboard"==a.device){var b={37:"Arrow Left",38:"Arrow Up",39:"Arrow Right",40:"Arrow Down",45:"Insert",46:"Delete",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"Caps Lock",27:"Escape",32:"Space",33:"Page Up",34:"Page Down",35:"End",36:"Home",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Num Lock",145:"Scroll Lock",186:"Semicolon",187:"Equal",188:"Comma",189:"Dash",190:"Period",191:"Slash",192:"Grave Accent",219:"Open Bracket",220:"Backslash",221:"Close Braket",222:"Single Quote"};return a.code>=48&&a.code<=90?"Keyboard "+String.fromCharCode(a.code).toLowerCase():"Keyboard "+b[a.code]}return"gamepad"==a.device&&"button"==a.type?"Gamepad Button "+a.code:"gamepad"==a.device&&a.type.match(/axes-\d/)?"Gamepad Axes "+a.code:""},f=function(b,c){a.set.key=b,a.set.callback=c,a.set.active=!0},g=function(){var b=this;$.each(a.command,function(a){b.command(a).set(function(){})})},h=function(b){var c={x:0,y:0};return a.gamepad.available&&(void 0==b&&(b=a.axes_selected),c=this.gamepad.axes(b)),0==c.x&&0==c.y&&a.orientation.available&&(c=this.orientation.axes()),c},i=function(a){var b=navigator.getGamepads()[0];if(b&&void 0!=b&&b.axes[2*a]&&b.axes[2*a+1]){var c={x:b.axes[2*a],y:b.axes[2*a+1]},d=function(a){var b={min:.1,max:.8};return Math.abs(a)<b.min?0:a>b.max?1:a<-b.max?-1:a>0?(a-b.min)/b.max:(a+b.min)/b.max};return c.x=d(c.x),c.y=d(c.y),c}return{x:0,y:0}},j=function(b){var e=function(b){a.gamepad.timestamp=b.timestamp;for(var c=0;c<=b.axes.length/2-1;c++)a.gamepad.axes[c]=h(c)},f=function(a,b,c,d,e){c>0&&c>a&&b>=c||0>c&&a>c&&c>=b?d():(c>0&&a>=c&&c>b||0>c&&c>=a&&b>c)&&e()},g=navigator.getGamepads()[0];if(g&&void 0!=g&&g.timestamp!=a.gamepad.timestamp)if(b){$.each(g.buttons,function(b,e){!a.gamepad.buttons[b]&&e.pressed?(c({device:"gamepad",type:"button",code:b}),e.pressed=!1):a.gamepad.buttons[b]&&!e.pressed&&(d({device:"gamepad",type:"button",code:b}),e.pressed=!0)});for(var j=0;j<=a.gamepad.axes.length-1;j++){var k=a.gamepad.axes[j],l=this.axes(j),m=.5;f(k.y,l.y,m,function(){c({device:"gamepad",type:"axes-"+j,code:"0"})},function(){d({device:"gamepad",type:"axes-"+j,code:"0"})}),f(k.y,l.y,-m,function(){c({device:"gamepad",type:"axes-"+j,code:"1"})},function(){d({device:"gamepad",type:"axes-"+j,code:"1"})}),f(k.x,l.x,m,function(){c({device:"gamepad",type:"axes-"+j,code:"2"})},function(){d({device:"gamepad",type:"axes-"+j,code:"2"})}),f(k.x,l.x,-m,function(){c({device:"gamepad",type:"axes-"+j,code:"3"})},function(){d({device:"gamepad",type:"axes-"+j,code:"3"})})}e(g)}else $.each(a.command,function(b,e){if("gamepad"==e.device){var h=function(){c(e)},j=function(){d(e)};if("button"==e.type)e.pressed!=g.buttons[e.code].pressed&&(e.pressed?j():h());else if(e.type.match(/axes-\d/)){var k=/axes-(\d)/.exec(e.type)[1];if(a.gamepad.axes[k]){var l,m,n=e.code%2==0?.5:-.5;2==e.code||3==e.code?(m=a.gamepad.axes[k].x,l=i(k).x):(m=a.gamepad.axes[k].y,l=i(k).y),f(m,l,n,h,j)}}}}),e(g)},k=function(){var b;b=a.orientation.gamma/30,b=Math.min(1,b),b=Math.max(-1,b);var c;return c=a.orientation.beta/30,c=Math.min(1,c),c=Math.max(-1,c),{x:b,y:c}},h=function(b){var c={x:0,y:0};return a.gamepad.available&&(void 0==b&&(b=a.axes_selected),c=i(b)),0==c.x&&0==c.y&&a.orientation.available&&(c=k()),c},l={up:38,down:40,left:37,right:39,enter:13,back:8};return $.each(l,function(b,c){a.command[b]={fn:function(){},device:"keyboard",type:null,code:c,pressed:!1}}),$(document).keydown(function(a){return c({device:"keyboard",type:null,code:a.keyCode})?!0:(a.preventDefault(),!1)}),$(document).keyup(function(a){return d({device:"keyboard",type:null,code:a.keyCode})?!0:(a.preventDefault(),!1)}),a.gamepad.available=navigator.getGamepads||navigator.webkitGamepads,navigator.getGamepads||(navigator.getGamepads=function(){return navigator.webkitGamepads?navigator.webkitGamepads:function(){return[]}}),j(!0),a.orientation.available=!!window.DeviceOrientationEvent,window.addEventListener("deviceorientation",function(b){a.orientation.beta=b.beta,a.orientation.gamma=b.gamma},!0),{options:a,command:b,format:e,ondown:c,onup:d,reset:g,set:f,axes:h,gamepad:{axes:i,poll:j},orientation:{axes:k}}}(),e=function(){var g={menu:function(){var a=$("div#menu",b.container);$("span",a).hover(function(){$(this).siblings().removeClass("selected"),$(this).addClass("selected")}),$("span",a).click(function(){e.show($(this).attr("data-screen"))}),$("span:first",a).addClass("selected");var c=function(){d.command("enter").set(function(){$("span.selected",a).click()}),d.command("up").set(function(){var b=$("span.selected",a);b.removeClass("selected"),b.prevAll().length>0?b.prev().addClass("selected"):b.parent().children().last().addClass("selected")}),d.command("down").set(function(){var b=$("span.selected",a);b.removeClass("selected"),b.nextAll().length>0?b.next().addClass("selected"):b.parent().children().first().addClass("selected")})},f=function(){},g=function(){d.gamepad.poll(!1)};return{container:a,showBefore:c,showAfter:f,loop:g}}(),gameplay:function(){var a=$("div#gameplay",b.container),c=function(){d.command("back").set(function(){f.pause()}),b.container.click(function(){f.pause()}),f.init()},e=function(){f.start()},g=function(){d.gamepad.poll(!1)};return{container:a,showBefore:c,showAfter:e,loop:g}}(),leaderboard:function(){var a=$("div#leaderboard",b.container);$("span.back",a).click(function(){e.show("menu")});var f=function(){d.command("back").set(function(){e.show("menu")}),c.get(0,10,$("table",a))},g=function(){},h=function(){d.gamepad.poll(!1)};return{container:a,showBefore:f,showAfter:g,loop:h}}(),"gameplay-gameover":function(){var a=$("div#gameplay-gameover",b.container);$("table",a).delegate("td","mouseover",function(){$("table tr td",a).removeClass("selected"),$(this).addClass("selected")}),$("table",a).delegate("td","click",function(){var d=$("input[type=text]",a);switch($(this).attr("data-action")){case"add":d.prop("maxlength")>d.val().length&&d.val(d.val()+$(this).attr("data-symbol"+("true"==$("td[data-action=shift]",a).attr("data-pressed")?"1":"2")));break;case"shift":var f=$(this).attr("data-pressed");f="true"==f?"false":"true",$(this).attr("data-pressed",f);var g=$("table tr td[data-action=add]",a);$.each(g,function(a,b){b=$(b),b.html("true"==f?b.html().toUpperCase():b.html().toLowerCase())});break;case"delete":d.val(d.val().slice(0,-1));break;case"cancel":e.show("gameplay-restart");break;case"submit":c.post(d.val(),$("span.score",a).html()),b.options.name=d.val(),b.save(),e.show("gameplay-restart")}});var f=function(c){d.command("up").set(function(){var b=$("table tr td.selected",a);if(b.parent().prevAll().length>0){var c=1;$.each(b.prevAll(),function(a,b){c+=$(b).prop("colspan")}),b.removeClass("selected");for(var d=b.parent().prev().children().first();c>0;){var e=d.prop("colspan");c>d.prop("colspan")&&(d=d.next()),c-=e}d.addClass("selected")}}),d.command("down").set(function(){var b=$("table tr td.selected",a);if(b.parent().nextAll().length>0){var c=1;$.each(b.prevAll(),function(a,b){c+=$(b).prop("colspan")}),b.removeClass("selected");for(var d=b.parent().next().children().first();c>0;){var e=d.prop("colspan");c>d.prop("colspan")&&(d=d.next()),c-=e}d.addClass("selected")}}),d.command("left").set(function(){var b=$("table tr td.selected",a);b.prevAll().length>0&&(b.removeClass("selected"),b.prev().addClass("selected"))}),d.command("right").set(function(){var b=$("table tr td.selected",a);b.nextAll().length>0&&(b.removeClass("selected"),b.next().addClass("selected"))}),d.command("enter").set(function(){$("table tr td.selected",a).click()}),d.command("back").set(function(){var b=$("input[type=text]",a);b.val(b.val().slice(0,-1))}),$("table tr td.selected",a).removeClass("selected"),$("table tr:nth-child(1) td:nth-child(1)",a).addClass("selected"),$("span.score",a).html(c),$("input[type=text]",a).val(b.options.name)},g=function(){},h=function(){d.gamepad.poll(!1)};return{container:a,showBefore:f,showAfter:g,loop:h}}(),"gameplay-restart":function(){var a=$("div#gameplay-restart",b.container);$("div span:nth-child(1)",a).click(function(){e.show("gameplay")}),$("div span:nth-child(2)",a).click(function(){e.show("menu")}),$("div span",a).hover(function(){$(this).siblings().removeClass("selected"),$(this).addClass("selected")}),$("span.back",a).click(function(){e.show("menu")});var c=function(){d.command("left").set(function(){$("div span:nth-child(1)",a).addClass("selected"),$("div span:nth-child(2)",a).removeClass("selected")}),d.command("right").set(function(){$("div span:nth-child(1)",a).removeClass("selected"),$("div span:nth-child(2)",a).addClass("selected")}),d.command("enter").set(function(){$("div span.selected",a).click()}),$("div span:nth-child(1)",a).addClass("selected"),$("div span:nth-child(2)",a).removeClass("selected")},f=function(){},g=function(){d.gamepad.poll(!1)};return{container:a,showBefore:c,showAfter:f,loop:g}}(),controls:function(){var a=$("div#controls",b.container);d.options.gamepad.available||$("tr[data-control=gamepad]",a).hide(),d.options.orientation.available||$("tr[data-control=orientation]",a).hide(),$("span.back",a).click(function(){e.show("menu")});var c=function(){d.command("back").set(function(){e.show("menu")}),d.gamepad.poll(!0),$.each($("span[data-command]",a),function(){$(this).html(d.format(d.options.command[$(this).attr("data-command")]))});$("tr[data-option=command] td button",a).click(function(){$("button",$(this).parent().parent().siblings().andSelf()).prop("disabled",!0);var b=$("span[data-command="+$(this).attr("data-command")+"]"),c=b.html();b.html("Please press a key... Esc to cancel"),d.set($(this).attr("data-command"),function(e){b.html(null!=e?d.format(e):c),$("button",a).prop("disabled",!1)})})},f=function(){},g=function(){var b=this;d.options.gamepad.available&&(d.gamepad.poll(!0),d.options.gamepad.axes.length!=$("tr[data-control=gamepad] td:nth-child(2) label",a).length&&($("tr[data-control=gamepad] td:nth-child(2)",a).html(""),$.each(d.options.gamepad.axes,function(a,c){$("tr[data-control=gamepad] td:nth-child(2)",b.container).append($("<label></label>").append($("<input>").attr("type","radio").attr("name","controls-gamepad-move").change(function(){d.options.gamepad.axes_selected=$(this).parent().parent().prevAll().length})).append($("<progress></progress>").attr("min",0).attr("max",2).val(c.x+1)).append($("<progress></progress>").attr("min",0).attr("max",2).val(c.y+1)))}),d.options.gamepad.axes_selected>d.options.gamepad.axes.length-1&&(d.options.gamepad.axes_selected=0),$("tr[data-control=gamepad] td:nth-child(2) label:nth-child("+(d.options.gamepad.axes_selected+1)+") input[type=radio]",b.container).prop("checked",!0)),$.each(d.options.gamepad.axes,function(a,c){$("tr[data-control=gamepad] td:nth-child(2) label:nth-child("+(a+1)+") progress:nth-child(2)",b.container).val(c.x+1),$("tr[data-control=gamepad] td:nth-child(2) label:nth-child("+(a+1)+") progress:nth-child(3)",b.container).val(c.y+1)})),d.options.orientation.available&&($("progress[data-control=orientation]:nth-child(1)",b.container).val(30*d.orientation.axes().x+30),$("progress[data-control=orientation]:nth-child(2)",b.container).val(30*d.orientation.axes().y+30))};return{container:a,showBefore:c,showAfter:f,loop:g}}(),options:function(){var c=$("div#options",b.container);$("tbody tr",c).hover(function(){$(this).siblings().removeClass("selected"),$(this).addClass("selected")}),$("input",c).on("change mousemove",function(){b.options.style=$("input[data-option=style]:checked",c).val(),a.music.options.mute=$("input[data-option=music-mute]",c).prop("checked"),a.music.options.volume=$("input[data-option=music-volume]",c).val(),a.sfx.options.mute=$("input[data-option=sfx-mute]",c).prop("checked"),a.sfx.options.volume=$("input[data-option=sfx-volume]",c).val(),b.options.speed=$("input[data-option=speed]",c).val(),b.save()}),$("input[data-option=fullscreen]",c).change(function(){screenfull.enabled&&($("input[data-option=fullscreen]",c).prop("checked")?screenfull.request():screenfull.exit())}),$("span.back",c).click(function(){e.show("menu")});var f=function(){d.command("up").set(function(){var a=$("table tr.selected",c);a.prevAll().length>0&&(a.removeClass("selected"),a.prev().addClass("selected"))}),d.command("down").set(function(){var a=$("table tr.selected",c);a.nextAll().length>0&&(a.removeClass("selected"),a.next().addClass("selected"))}),d.command("enter").set(function(){var a=$("table tr.selected input[type=checkbox]",c);1==a.length&&a.prop("checked",!a.prop("checked")).trigger("change")}),d.command("left").set(function(){var a=$("table tr.selected",c),b=$("input[type=radio]:checked",a);1==b.length&&1==b.parent("label").prev().length&&(b.prop("checked",!1),b.parent("label").prev().children("input[type=radio]").prop("checked",!0).trigger("change"));var d=$("input[type=range]",a);if(1==d.length){var e=1;d.attr("step")&&(e=parseFloat(d.attr("step"))),d.val(parseFloat(d.val())-e).trigger("change")}}),d.command("right").set(function(){var a=$("table tr.selected",c),b=$("input[type=radio]:checked",a);1==b.length&&1==b.parent("label").next().length&&(b.prop("checked",!1),b.parent("label").next().children("input[type=radio]").prop("checked",!0).trigger("change"));var d=$("input[type=range]",a);if(1==d.length){var e=1;d.attr("step")&&(e=parseFloat(d.attr("step"))),d.val(parseFloat(d.val())+e).trigger("change")}}),d.command("back").set(function(){e.show("menu")}),$("table tr:nth-child(1)",c).addClass("selected"),$("input[value="+b.options.style+"]",c).prop("checked",!0),$("input[data-option=music-mute]",c).prop("checked",a.music.options.mute),$("input[data-option=music-volume]",c).val(a.music.options.volume),$("input[data-option=sfx-mute]",c).prop("checked",a.sfx.options.mute),$("input[data-option=sfx-volume]",c).val(a.sfx.options.volume),$("input[data-option=speed]",c).val(b.options.speed)},g=function(){},h=function(){d.gamepad.poll(!1)};return{container:c,showBefore:f,showAfter:g,loop:h}}(),about:function(){var a=$("div#about",b.container);$("span.back",a).click(function(){e.show("menu")});var c=function(){d.command("back").set(function(){e.show("menu")})},f=function(){},g=function(){d.gamepad.poll(!1)};return{container:a,showBefore:c,showAfter:f,loop:g}}()},h=function(a,b){if(d.reset(),a=g[a],a.showBefore(b),a.container.siblings(":visible").length>0?a.container.siblings(":visible").fadeOut(250,function(){a.container.fadeIn(250)}):a.container.show(),a.loop){var c=function(){var b=a.loop();void 0==b&&(b=!0),a.container.is(":visible")&&b&&window.requestAnimationFrame(c)};window.setTimeout(function(){window.requestAnimationFrame(c)},500)}a.showAfter(b)};return h("menu"),{show:h}}(),f={game:null,init:function(){var a=$("div#gameplay",b.container);a.html(""),this.game=new Playground({container:a.get(0),width:480,height:432,background:{x:0,y:0,img:null,src:"",width:0,height:0},character:{maxwidth:48,maxheight:48,x:0,y:0,img:null,src:"",width:32,height:32},obstacle:{items:[{img:null,src:"",src_suffix:"-1x1",spawnprobability:5,create:function(a){return{img:this.img,x:Math.round(Math.randomRange(0,a.width-50)),y:-50,width:50,height:50,spawntime:a.time,game:a,calc:function(b){this.y+=b*a.obstacle.speed*a.getSpeedFactor()}}}},{img:null,src:"",src_suffix:"-1x2",spawnprobability:4,create:function(a){return{img:this.img,x:Math.round(Math.randomRange(0,a.width-50)),y:-100,width:50,height:100,spawntime:a.time,game:a,calc:function(b){this.y+=b*a.obstacle.speed*a.getSpeedFactor()}}}},{img:null,src:"",src_suffix:"-2x1",spawnprobability:4,create:function(a){return{img:this.img,x:Math.round(Math.randomRange(0,a.width-100)),y:-50,width:100,height:50,spawntime:a.time,game:a,calc:function(b){this.y+=b*a.obstacle.speed*a.getSpeedFactor()}}}},{img:null,src:"",src_suffix:"-1x1",spawnprobability:2,create:function(a){return{img:this.img,x:Math.round(Math.randomRange(0,a.width-50)),y:-50,width:50,height:50,spawntime:a.time,game:a,calc:function(b){this.y+=b*a.obstacle.speed*a.getSpeedFactor()*2}}}},{img:null,src:"",src_suffix:"-1x1",spawnprobability:1,create:function(a){var b=150,c=Math.round(Math.randomRange(b/2,a.width-50-b/2));return{img:this.img,x:c,x_org:c,y:-50,width:50,height:50,spawntime:a.time,game:a,calc:function(c){this.x=this.x_org+Math.sin(4*(this.spawntime-a.time))*b/2,this.y+=c*a.obstacle.speed*a.getSpeedFactor()}}}}],next:{time:0,min:.5,max:2.5,calc:function(a){this.time=a+Math.randomRange(this.min,this.max)}},speed:100,speed_time:10,speed_factor:1.15},obstacles:[],states:{create:0,countdown:1,running:2,pause:3,gameover:4},state:0,prepared:!1,time:0,score:0,points:{time:10,obstacle:.005},create:function(){this.prepared=!1,this.background.src=b.options.style+"/background",this.loadImages(this.background.src+".jpg"),this.character.src=b.options.style+"/character",this.loadImages(this.character.src);var a=this;$.each(this.obstacle.items,function(c,d){a.loadImages(b.options.style+"/obstacle"+d.src_suffix),d.src=b.options.style+"/obstacle"+d.src_suffix}),this.obstacle.next.calc(0),this.obstacles=[],this.time=-3,this.score=0},step:function(a){var c=this;if(!this.prepared){if(null==this.background.img){this.background.img=this.images[this.background.src];var e=this.width/this.background.img.naturalWidth;this.background.width=Math.round(this.background.img.naturalWidth*e),this.background.height=Math.round(this.background.img.naturalHeight*e)}if(null==this.character.img){this.character.img=this.images[this.character.src];var f=this.character.maxwidth/this.character.img.naturalWidth,g=this.character.maxheight/this.character.img.naturalHeight,e=Math.min(f,g);this.character.width=Math.round(this.character.img.naturalWidth*e),this.character.height=Math.round(this.character.img.naturalHeight*e),this.character.x=(this.width-this.character.width)/2,this.character.y=this.height-this.character.height}$.each(this.obstacle.items,function(a,b){b.img=c.images[b.src]}),this.prepared=!0}if(this.state==this.states.countdown)this.prepared&&(this.time+=a,this.time>=0&&(this.state=this.states.running));else if(this.state==this.states.running){this.time+=a,this.score+=a*this.points.time,this.background.y=(this.background.y+this.obstacle.speed*a*c.getSpeedFactor())%this.background.height,d.gamepad.poll(!1);var h=0,i=0;if(h=d.axes().x,i=d.axes().y,0==h&&(d.command("left").pressed&&!d.command("right").pressed?h=-1:!d.command("left").pressed&&d.command("right").pressed&&(h=1)),0==i&&(d.command("up").pressed&&!d.command("down").pressed?i=-1:!d.command("up").pressed&&d.command("down").pressed&&(i=1)),this.character.x+=h*b.options.speed*a,this.character.x=Math.max(this.character.x,0),this.character.x=Math.min(this.character.x,this.width-this.character.width),this.character.y+=i*b.options.speed*a,this.character.y=Math.max(this.character.y,0),this.character.y=Math.min(this.character.y,this.height-this.character.height),this.time>=this.obstacle.next.time){var j=this.obstacle.items.reduce(function(a,b){return a.push(b.spawnprobability),a},[]),k=Math.randomWeighted(j);this.obstacles.push(this.obstacle.items[k].create(this)),this.obstacle.next.calc(this.time)}$.each(this.obstacles,function(b,d){d.calc(a),c.character.x<d.x+d.width&&c.character.x+c.character.width>d.x&&c.character.y<d.y+d.height&&c.character.height+c.character.y>d.y&&c.collision()}),this.obstacles=$.grep(this.obstacles,function(a){var b=a.y>=c.height;return b&&(c.score+=c.points.obstacle*a.width*a.height),!b})}},render:function(){var a=this;this.layer.clear("#FFFFFF");for(var b=this.background.y-this.background.height;b<this.height;)this.layer.drawImage(this.background.img,this.background.x,b,this.background.width,this.background.height),b+=this.background.height-1;if(this.layer.drawImage(this.character.img,this.character.x,this.character.y,this.character.width,this.character.height),$.each(this.obstacles,function(b,c){a.layer.drawImage(c.img,c.x,c.y,c.width,c.height)}),this.layer.fillStyle("#FFFFFF").font("16px Arial").wrappedText("Time:  "+Math.floor(this.time).toString()+"s",5,16).wrappedText("Score: "+Math.floor(this.score).toString(),5,40),this.state==this.states.countdown){this.layer.font("200px Arial");var c=Math.abs(Math.floor(this.time)).toString();textboundaries=this.layer.textBoundaries(c),this.layer.fillStyle("#FFFFFF").wrappedText(c,(this.width-textboundaries.width)/2,(this.height+textboundaries.height)/2)}if(this.state==this.states.pause){this.layer.font("100px Arial");var c="Pause";textboundaries=this.layer.textBoundaries(c),this.layer.fillStyle("#FFFFFF").wrappedText(c,(this.width-textboundaries.width)/2,(this.height+textboundaries.height)/2)}},collision:function(){this.state=this.states.gameover,$(this.container).html(""),e.show("gameplay-gameover",Math.floor(this.score))},getSpeedFactor:function(){return Math.pow(this.obstacle.speed_factor,Math.floor(this.time/this.obstacle.speed_time))}})},start:function(){this.game.state=this.game.states.countdown},pause:function(){this.game.state==this.game.states.running?this.game.state=this.game.states.pause:this.game.state==this.game.states.pause&&(this.game.state=this.game.states.running)}}});